%
% !TEX root = ../main.tex
%

\chapter{Differential Algebraic Equations for Mechanics}
	\label{ch:overview}
	\section{Overview of Lagrangian Mechanics}
		\label{sec:overview}
		Most of the following section is inspired by \cite{arnold1989mathematical} 
		and \cite{marsden2013introduction}, which are advanced classical textbooks 
		on classical mechanics.
		Mechanics deals with the dynamics of particles, rigid bodies, 
		continuous media and field theories such as electromagnetism, 
		gravity, etc.
		The foundations were laid by Newton in the $17$th century and since then 
		many generalizations and extensions have been proposed.
		To date Mechanics has two main point of view, \emph{Lagrangian mechanics} 
		and \emph{Hamiltonian mechanics}.
		In these notes we will briefly recall some concepts of Lagrangian Mechanics, 
		for insights see \cite{marsden2013introduction}.
		The Lagrangian formulation of mechanics is based on the observation
		that there are \emph{variational principles} behind the fundamental
		laws of force balance, as given by Newton's law $\bm{F}=m\bm{a}$.
		This principle is called \emph{least action}, or more accurately,
		the principle of \emph{stationary action}.
		This principle can be successfully applied to every mechanical 
		system to obtain the equations of motion.
		The idea is fairly general, since it can be used to derive Newtonian, 
		Lagrangian, and Hamiltonian equations of motion.
		However, here we will focus only on mechanical systems with a 
		finite number of \emph{degrees of freedom}.
		For those systems the \emph{configuration} can be identified through a
		vector of \emph{generalized coordinates} 
		$\bm{q} := (q_{1}; q_{2}; \dots ;q_{n})\in\mathbb{R}^{n}$, 
		where $n$ is the \emph{minimum} number of \emph{degrees of freedom}.
		Notice that the choice of vector $\bm{q}$ is not unique.
		After choosing a ordered set of coordinate $\bm{q}$,
		it is always possible to express \emph{kinetic} and the \emph{potential}
		energy as a function of it. Thus let us define $T(\bm{q},\bm{q})$ as the
		\emph{kinetic energy} and $U(\bm{q},t)$ as the \emph{potential energy}.
		Roughly we can think $T, U$ as functions whose domain of definition
		is simply the direct product of Euclidean spaces, i.e., 
		$T:\mathbb{R}^{n}\times\mathbb{R}^{n}\rightarrow\mathbb{R}_{\geq0}$ and
		$U:\mathbb{R}^{n}\times\mathbb{R}\rightarrow\mathbb{R}$.
		However this is not completely true, since vector $\bm{q}$
		may represent a coordinatization of more abstract surfaces,
		namely \emph{manifolds}; however (locally) we can think at Euclidean spaces.
		Once the \emph{energy} of the system has been defined we can introduce 
		the so called \emph{Lagrangian function} $L(\bm{q},\dot{\bm{q}},t)$,
		whose domain is $L:\mathbb{R}^{n}\times\mathbb{R}^{n}\times\mathbb{R}\rightarrow\mathbb{R}$.
		In classical Mechanics the Lagrangian is defined as the difference 
		between \emph{kinetic} and \emph{potential} energy, formally
		%%%
		\begin{equation}
			\label{eq:lagrangianfunction}
			L(\bm{q},\dot{\bm{q}},t) := T(\bm{q},\dot{\bm{q}}) - U(\bm{q},t).
		\end{equation}
		%%%
		\begin{example}
			\label{ex:nonuniquessofq}
			Let us consider a very simple example, a free mass point in 
			the plane subject to gravity in the $y$ downward direction, 
			see \cref{fig:examplelagrangian}.
			%%%
			\input{pictures/lagrangian_example_point}
			%%%
			The kinetic and the potential energy for the system are, 
			%%%
			\begin{equation*}
				T = \frac{1}{2}m(\dot{x}^{2}+\dot{y}^{2}), \quad U = mgy,
			\end{equation*}
			%%%
			thus taking $\bm{q} = (x;y)\in\mathbb{R}^{2}$ as a vector
			of generalized coordinates the Lagrangian function is of the form 
			%%%
			\begin{equation*}
				L = \frac{1}{2}m\transp{\bm{\dot{q}}}\bm{\dot{q}} - mg\transp{\bm{e}}\bm{q},
			\end{equation*}
			%%%
			where $e_{2}=(0;1)\in\mathbb{R}^{2}$.
			Nevertheless Cartesian coordinates is not the only possible choice,
			thus considering \emph{polar} coordinates the following relations hold
			%%%
			\begin{subequations}
				\begin{align*}
					x &= r\cos{\theta}, & y &= r\sin{\theta}, \\
					\dot{x} &= \dot{r}\cos{\theta} -
					r\sin{\theta}\dot{\theta}, & \dot{y} &= \dot{r}\sin{\theta}+r\cos{\theta}\dot{\theta},
				\end{align*}
			\end{subequations}
			%%%
			where $r\in\mathbb{R}_{\geq 0}$ is the radius and $\theta\in[0,2\pi)$ 
			the angular coordinate.
			Then taking some steps the kinetic and potential energies can be expressed as, 
			%%%
			\begin{equation*}
				T = \frac{1}{2}m(\dot{r}^{2}+r^{2}\dot{\theta}^{2}), \quad U = mgr\sin{\theta}.
			\end{equation*}
			%%%
			Thus taking $\widetilde{\bm{q}}:=(\widetilde{q}_{1};\widetilde{q}_{2})=(r;\theta)\in\mathbb{R}^{2}$ 
			as generalized coordinates the Lagrangian is
			%%%
			\begin{equation}
				L = \frac{1}{2}m(\dot{\widetilde{q}}_{1}^{2}+\widetilde{q}_{1}^{2}
				\dot{\widetilde{q}}_{2}^{2}) - mg\widetilde{q}_{1}\sin{\widetilde{q}_{2}}.
			\end{equation}
			%%%
			This simple example shows that the choice of generalized coordinates 
			is not unique but it can be performed according to a criterion of simplicity or utility.
			As we will see shortly the Lagrangian formulation provides the correct
			equation of motion despite the chosen reference system. 
		\end{example}
		%%%
		A very related concept in classical mechanics is the \emph{action} $S\in\mathbb{R}$,
		this is defined as the integral of the Lagrangian function performed between 
		two instants of time $t_{1},t_{2}\in\mathbb{R}$, i.e.,
		%%%
		\begin{equation}
			\label{eq:actiondefinition}
			S := \int_{t_{1}}^{t_{2}}L(\bm{q},\dot{\bm{q}},t)\diff t.
		\end{equation}
		%%%
		Technically speaking the action is a \emph{functional}, i.e., a 
		map that associate to each element of a vector space (usually a space of curves) a scalar. 
		Thus a functional takes curves as input an returns a scalar.
		%%%
		\begin{remark}
			Notice that $S=S(\bm{q})$ should be thought as a function of
			$\bm{q}(t)$ over the whole time interval $[t_{1},t_{2}]$.
			From this point onwards we will use the notation $\bm{q}(\cdot)$
			to denote the function $\bm{q}$,
			while $\bm{q}(t)$ will be denote the \emph{value of function}
			$\bm{q}$ at the point $t$. Clarified this it is very important
			to stress that $S$ does not depends on $q(t)$ but from $q(\cdot)$
			and it is just a number.
			Thus for every choice of the ``shape'' of curve $\bm{q}(\cdot)$, 
			the action $S$ assumes a different (scalar) value.
		\end{remark}
		%%%
		\begin{example}
			Suppose that $\bm{q} = (q_{1};q_{2})\in\mathbb{R}^{2}$, 
			$t_{1} = 0$, $t_{2} = 1$ and $L = q_{1}^{2} + q_{2}^{2}$,
			thus the action is the following, 
			%%%
			\begin{equation*}
				S = \int_{0}^{1} q_{1}^2 +q_{2}^{2}\diff t.
			\end{equation*}
			%%%
			Take now $\bm{q} = (2;t)$, calculating the value for the action results
			%%%
			\begin{equation*}
				S = \int_{0}^{1} 2^{2} + t^{2}\diff t = \left[4t+\frac{t^{3}}{3}\right]_{0}^{1} = \frac{13}{3}.
			\end{equation*}
			%%%
		\end{example}
		%%%
		Similarly as seen in analysis courses you may ask yourself if there 
		exist a curve that minimizes or maximizes the action.
		The answer has created a new branch of mathematics, i.e., the
		\emph{calculus of variations}. Calculus of variations concerns the \emph{extremal}
		of functionals whose domain is an infinite-dimensional space: the space of curves.
		As we will see shortly the \emph{stationary action principle} simply says that
		every mechanical system evolves along a curve $\bm{q}(\cdot)$ that is an extremal
		of the action functional $S$.
		In order to state more formally the stationary action principle,
		let us consider an initial time $t_{1}$ and an initial configuration
		associated to it, $\bm{q}_{1} = \bm{q}(t_{1})$, consider also a final
		time $t_{2}$ and a final configuration $\bm{q}_{2}=\bm{q}(t_{2})$.
		%%%
		\begin{theorem}[Stationary action]
			\label{th:stationaryaction}
			Motions of mechanical systems from configuration $\bm{q}_{1}$
			to configuration $\bm{q}_{2}$, with $t\in[t_{1},t_{2}]$,
			coincide with extremals curves of the functional in \cref{eq:actiondefinition}.
			Or equivalently, for small variations of the curve $\bm{q}(\cdot)$ the action $S$ is stationary, i.e.,
			%%%
			\begin{equation}
				\delta S = 0.
			\end{equation}
			%%%
		\end{theorem}
		%%%
		Where $\delta$ denotes a small perturbation of the functional
		$S$ and sometimes it is also called \emph{variational operator}.
		%%%
		\begin{example}
			The $\delta$ operator can be successfully applied also to ordinary calculus.
			Let us consider the function $f(x,y) = \cos(x) + y^2$, then a variation of $f$ results
			%%%
			\begin{equation*}
				\delta f = \frac{\partial f}{\partial x}\delta x +
				\frac{\partial f}{\partial y}\delta y = \begin{pmatrix} \cos{x} &
			   y \end{pmatrix}\begin{pmatrix}\delta x \\ \delta y \end{pmatrix}.
			\end{equation*}
			%%%
			In this setting stationary points are the ones that satisfies $\delta f = 0$ 
			since for \emph{first order} variation $(\delta x,\delta y)$ the corresponding
			variation of $f$ is zero.
			(The surface is locally flat and the variation on $f$ is visible only at the second order).
			Therefore the stationary points are $(\frac{\pi}{2}+k\pi,0)$ for $k = 1,2,\dots$.
		\end{example}
		%%%
		Now let us develop the consequences of this principle.
		Assuming $L$ regular enough is possible to move the $\delta$ operator under the integral,
		%%%
		\begin{equation}
			\label{eq:actionvariation}
			\delta S = \int_{t_{1}}^{t_{2}}\delta L(\bm{q},\dot{\bm{q}},t) 
			\diff t = \int_{t_{1}}^{t_{2}}\frac{\partial L}{\partial \bm{q}}
			\delta \bm{q} + \frac{\partial L}{\partial \dot{\bm{q}}}\delta\dot{\bm{q}} \diff t.  
		\end{equation}
		%%%
		\begin{remark}
			Notice that variations are performed at \emph{fixed time}, 
			therefore the generic variation 
			$\delta L(\bm{q}(t),\bm{\dot{q}}(t),t) 
			 = \frac{\partial L}{\partial\bm{q}}\delta \bm{q}+\frac{\partial L}{\partial\bm{\dot{q}}}
			 \delta\bm{\dot{q}}$
			and not $\delta L(\bm{q}(t),\bm{\dot{q}}(t),t)\neq\frac{\partial L}{\partial\bm{q}}
			\delta \bm{q}+\frac{\partial L}{\partial\bm{\dot{q}}}
			\delta\bm{\dot{q}}+\frac{\partial L}{\partial t}\delta t$.
			Moreover we must think at the $\dot{\bm{q}}$ variable as independent
			of $\bm{q}$, since it can be proven that for small variations those
			quantities are uncorrelated each other.
		\end{remark}
		%%%
		Now it is useful to consider the following equality that directly follows from integration by part,
		%%%
		\begin{equation}
			\label{eq:intbypart}
			\frac{\partial L}{\partial\dot{\bm{q}}}\delta\dot{\bm{q}}
			= \frac{\diff}{\diff t}\left(\frac{\partial L}{\partial\dot{\bm{q}}}
			\delta \bm{q}\right)-\frac{\diff}{\diff t}\frac{\partial L}{\partial \bm{\dot{q}}}\delta \bm{q},
		\end{equation}
		%%%
		then substituting \cref{eq:intbypart} into \cref{eq:actionvariation} results,
		%%%
		\begin{subequations}
			\begin{align}
				\delta S 
				&= \int_{t_{1}}^{t_{2}}\frac{\diff}{\diff t}
				\left(\frac{\partial L}{\partial\dot{\bm{q}}}\delta \bm{q}\right)-\frac{\diff}{\diff t}
				\frac{\partial L}{\partial \bm{q}}\delta \bm{q} + 
				\frac{\partial L}{\partial \bm{q}}\delta \bm{q}\diff t \\
				\label{eq:deltaS}
				&= \left[\frac{\partial L}{\partial\dot{\bm{q}}}\delta \bm{q}\right]_{t_{1}}^{t_{2}}+
				\int_{t_{1}}^{t_{2}}\left(\frac{\partial L}{\partial \bm{q}}
				-\frac{\diff}{\diff t}\frac{\partial L}{\partial\dot{\bm{q}}}\right)\delta \bm{q}\diff t \\
				&= \int_{t_{1}}^{t_{2}}\left(\frac{\partial L}{\partial \bm{q}}
				-\frac{\diff}{\diff t}\frac{\partial L}{\partial\dot{\bm{q}}}\right)\delta \bm{q}\diff t = 0
			\end{align}
		\end{subequations}
		%%%
		\begin{remark}
			In developing passage (\ref{eq:deltaS}) we used 
			$\left[\frac{\partial L}{\partial\dot{\bm{q}}}\delta \bm{q}\right]_{t_{1}}^{t_{2}} = 0$,
			since variations
			$\delta\bm{q}(t_{1}) = \delta\bm{q}(t_{2})$ are assumed to be zero because we fixed 
			\emph{a priori} initial and final conditions $\bm{q}_{1}$,$\bm{q}_{2}$.
			The concept is graphically illustrated in fig. (\ref{fig:variations}), 
			where a set of possible variations is considered but all are vanishing at the endpoints.
		\end{remark}
		%%%
		\input{pictures/variations.tex}
		%%%
		We are now ready to further simplify \cref{eq:deltaS} using the 
		\emph{fundamental lemma of calculus of variations}, which adapted
		for our purposes states the following:
		%%%
		\begin{lemma}[Fundamental lemma of calculus of variations]
			\label{lem:foundamentallemma}
			Let $S$ be a \emph{differentiable} (in variational sense) functional, then if
			%%%
			\begin{equation}
				\int_{t_{1}}^{t_{2}}\left(\frac{\partial L}{\partial \bm{q}}
				-\frac{\diff}{\diff t}\frac{\partial L}{\partial\dot{\bm{q}}}\right)\delta \bm{q}\diff t = 0,
			\end{equation}
			%%%
			for any smooth variation $\delta\bm{q}$ with $\delta\bm{q}_{1}=\delta\bm{q}_{2}=0$, then, 
			%%%
			\begin{equation}
				\label{eq:euleroequations}
				\frac{\diff}{\diff t}\frac{\partial L}{\partial\dot{\bm{q}}}^{\intercal}
				-\frac{\partial L}{\partial \bm{q}}^{\intercal} = 0.
			\end{equation}
			%%%
		\end{lemma}	
		%%%
		The \cref{eq:euleroequations} are called \emph{Euler-Lagrange} equations and they
		provide the equations of motions for mechanical systems.
		Roughly speaking \cref{lem:foundamentallemma} states that since the variation
		$\delta\bm{q}$ is arbitrary, the only way to zeroing the action's
		variation $\delta S$ is to satisfy Euler-Lagrange equations.
		Thus we can collect our results in the following theorem.
		%%%
		\begin{theorem}
			\label{th:minimalaction}
			The curve $q:t\mapsto q(t)$, for $t\in[t_{1},t_{2}]$, 
			is an extremal of the functional $S$ on the space of curves passing
			through the points $\bm{q}(t_{1}) =\bm{q}_{1}$ and $\bm{q}(t_{2}) = \bm{q}_{2}$,
			if and only if
			%%%
			\begin{equation}
				\frac{\diff}{\diff t}\frac{\partial L}{\partial\dot{\bm{q}}}^{\intercal}
				-\frac{\partial L}{\partial \bm{q}}^{\intercal} = 0.
			\end{equation}
			%%%
		\end{theorem}
		%%%
		The key idea of \cref{th:minimalaction} is that a curve $\bm{q}(\cdot)$ in order 
		to be a stationary point for the action $S$, must satisfy the Euler-Lagrange equations,
		and therefore according to \cref{th:stationaryaction} Euler-Lagrange equations
		provide the equations of motion for mechanical systems.
		Notice also that the variational approach is \emph{coordinate free}, meaning that,
		Euler-Lagrange equations describe the motion regardless the chosen set of coordinates.
		Indeed the condition for a curve to be an extremal of a functional does
		not depend on the choice of coordinate systems.
		%%%
		\begin{example}
			Considering the free mass point in \cref{ex:nonuniquessofq}
			the equations of motions in the Cartesian coordinates are
			%%%
			\begin{equation}
				\label{eq:cartesiancoordinates}
				\frac{\diff}{\diff t}
				\frac{\partial L}{\partial\bm{\dot{q}}}^{\intercal} 
				- \frac{\partial L}{\partial\bm{q}}^{\intercal} = m\ddot{\bm{q}} + mg\bm{e}_{2} = 0,
			\end{equation}
			%%%
			while in polar coordinates,
			%%%
			\begin{subequations}
				\begin{align}
					\frac{\diff}{\diff t}\frac{\partial L}{\partial\dot{\widetilde{q}_{1}}} 
					- \frac{\partial L}{\partial\widetilde{q}_{1}} 
					&= m\ddot{\widetilde{q}}_{1} +  mg\sin{\widetilde{q}_{2}}, \\
					\frac{\diff}{\diff t}\frac{\partial L}{\partial\dot{\widetilde{q}_{2}}} 
					- \frac{\partial L}{\partial\widetilde{q}_{2}}
					&= m\widetilde{q}_{1}^{2}\ddot{\widetilde{q}}_{2} +
					2m\widetilde{q}_{1}\dot{\widetilde{q}}_{1}\dot{\widetilde{q}}_{2}
					+ mg\widetilde{q}_{1}\cos{\widetilde{q}_{2}} = 0.
				\end{align}
				\label{eq:polarcoordinates}
			\end{subequations}
			%%%
			Solutions $q(\cdot)$ and $\widetilde{q}(\cdot)$ respectively solutions 
			of \cref{eq:cartesiancoordinates} and \cref{eq:polarcoordinates} describe
			the same motion in the plane, just in different coordinate systems.
		\end{example} 
		%%%
		Nevertheless as presented so far the Euler-Lagrange approach has a big limitation,
		since $L$ depends only on kinetic and potential energy, we can describe only systems
		subject to forces that admit a potential function $U$, i.e., \emph{conservative systems}.
		Luckily the Euler-Lagrange approach can be extended to \emph{nonconservative forces}
		using the \emph{D'Alembert's principle}, thus \cref{eq:euleroequations} is modified as follows
		%%%
		\begin{equation}
			\frac{\diff}{\diff t}\frac{\partial L}{\partial\dot{\bm{q}}}^{\intercal}
			-\frac{\partial L}{\partial \bm{q}}^{\intercal} = \bm{\tau},
		\end{equation}
		%%%
		where $\bm{\tau}\in\mathbb{R}^{n}$ is a vector of \emph{generalized} non conservative forces.
		
	\section{Mechanical equations of motion}
		
		Although Euler-Lagrange equations are very general is often useful 
		to consider an explicit representation for mechanical systems with some 
		special properties.
		For this purpose we will assume that the kinetic energy $T(\bm{q},\dot{\bm{q}})$
		has a very special structure, i.e., is a quadratic form in the generalized
		velocities $\dot{\bm{q}}$.
		This is not a very restrictive assumption since every mechanical system with
		a finite number of degrees of freedom owns a quadratic kinetic energy.
		From this simple assumption a lot of interesting properties can be derived;
		for a good survey see \cite{siciliano2009robotics}.
		An explicit expression for kinetic energy is
		%%%
		\begin{equation}
			T(\bm{q},\dot{\bm{q}}) = 
			\frac{1}{2}\sum_{j=1}^{n}\sum_{k=1}^{n}m_{jk}(\bm{q})\dot{q}_{j}\dot{q}_{k}
			= \frac{1}{2}\dot{\bm{q}}^{\intercal}\bm{M}(\bm{q})\dot{\bm{q}},
		\end{equation}
		%%%
		where $\bm{M}(\bm{q})\in\mathbb{R}^{n\times n}$ is a symmetric positive definite matrix,
		usually called \emph{mass matrix}.
		The entries $m_{jk}(\bm{q})\in\bm{M}(\bm{q})$, for $j,k=1,\dots,n$ are
		\emph{generalized masses} and \emph{generalized inertias}.
		%%%
		\begin{remark}
			The matrix $\bm{M}(\bm{q})$ is symmetric since the quadratic
			form associated to a matrix only depends on symmetric part.
		\end{remark}
		%%%
		We are now interested in developing an explicit representation for the
		equations of motion associated to mechanical systems with a \emph{quadratic} kinetic energy.
		In order to do so we need to perform some tedious calculations.
		Let us start from Euler-Lagrange equations in \cref{eq:euleroequations},
		the term $\frac{\diff}{\diff t}\frac{\partial L}{\partial \dot{q}_{i}}$ appears as
		%%%
		\begin{equation*}
			\frac{\diff}{\diff t}\frac{\partial L}{\partial \dot{q}_{i}}
			= \frac{\diff}{\diff t}\frac{\partial T}{\partial \dot{q}_{i}}
			= \frac{\diff}{\diff t}\frac{\partial}{\partial\dot{q}_{i}}
			\left(\frac{1}{2}\sum_{j=1}^{n}\sum_{k=1}^{n}m_{jk}(\bm{q})\dot{q}_{j}\dot{q}_{k}\right).
		\end{equation*}
		%%%
		for $i = 1,\dots,n$.
		Then exploiting the linearity of summation we can exchange the order
		between partial derivative and the sum, so that 
		%%%
		\begin{subequations}
			\label{eq:blekinetic}
			\begin{align}
				\frac{\diff}{\diff t}\frac{\partial L}{\partial \dot{q}_{i}} 
				&= \frac{\diff}{\diff t}\left(\frac{1}{2}\sum_{j=1}^{n}
				\sum_{k=1}^{n}m_{jk}(\bm{q})\frac{\partial\dot{q}_{j}}{\partial\dot{q}_{i}}\dot{q}_{k}
				+\frac{1}{2}\sum_{j=1}^{n}\sum_{k=1}^{n}m_{jk}(\bm{q})\dot{q}_{j}
				\frac{\partial\dot{q}_{k}}{\partial\dot{q}_{i}}\right)\\
				&=\frac{\diff}{\diff t}\left(\frac{1}{2}\sum_{k=1}^{n}m_{ik}(\bm{q})\dot{q}_{k}
				+\frac{1}{2}\sum_{j=1}^{n}m_{ji}(\bm{q})\dot{q}_{j}\right)\\
				&= \frac{\diff}{\diff t}\left(\sum_{j=1}^{n}m_{ij}(\bm{q})\dot{q}_{j}\right).
			\end{align}
		\end{subequations}
		%%%
		In last passage we used the fact that
		$\frac{\partial\dot{q}_{j}}{\partial\dot{q}_{i}} = 1$ for $i = j$ and $0$ otherwise,
		and the same holds for $\frac{\partial\dot{q}_{k}}{\partial\dot{q}_{i}}$,
		moreover we also used the symmetry $m_{ij}(\bm{q})=m_{ji}(\bm{q})$ for $i,j = 1,\dots,n$.
		Finally deriving with respect to time results,
		%%%
		\begin{equation}
			\label{eq:firstparteulerlagrange}
			\frac{\diff}{\diff t}\frac{\partial L}{\partial\dot{q}_{i}}
			= \sum_{j=1}^{n}m_{ij}(\bm{q})\ddot{q}_{j}
			+ \sum_{j=1}^{n}\sum_{k=1}^{n}
			\frac{\partial m_{ij}(\bm{q})}{\partial q_{k}}\dot{q}_{k}\dot{q}_{j}.
		\end{equation}
		%%%
		The obtained expression in \cref{eq:firstparteulerlagrange} is just a part
		of the Euler-Lagrange equations; considering then the term
		$\frac{\partial L}{\partial q_{i}}$, for $i=1,\dots,n$, results 
		%%%
		\begin{equation}
			\label{eq:secondparteulerlagrange}
			\frac{\partial L}{\partial q_{i}} 
			= \frac{1}{2} \sum_{j=1}^{n}
			\sum_{k=1}^{n}\frac{\partial m_{jk}(\bm{q})}{\partial q_{i}}\dot{q}_{k}\dot{q}_{j}
			-\frac{\partial U(\bm{q},t)}{\partial q_{i}}.
		\end{equation}
		%%%
		In order to obtain a more compact representation let us define 
		%%%
		\begin{equation*}
			g_{i}(\bm{q}) := \frac{\partial U(\bm{q},t)}{\partial q_{i}},
		\end{equation*}
		%%%
		for $i=1,\dots,n$ and the associate vector 
		$\bm{g}(\bm{q}):=(g_{1}(\bm{q});\dots;g_{n}(\bm{q}))\in\mathbb{R}^{n}$.
		Combining together \cref{eq:firstparteulerlagrange} and \cref{eq:secondparteulerlagrange},
		the overall equations of motion written componentwise result,
		%%%
		\begin{equation}
			\label{eq:lageqbla}
			\sum_{j=1}^{n}m_{ij}(\bm{q})\ddot{q}_{j} +
			\sum_{j=1}^{n}\sum_{k=1}^{n}\frac{\partial m_{ij}(\bm{q})}{\partial q_{k}}\dot{q}_{j}\dot{q}_{k}
			-\frac{1}{2}\sum_{j=1}^{n}\sum_{k=1}^{n}
			\frac{\partial m_{jk}(\bm{q})}{\partial q_{i}}
			\dot{q}_{j}\dot{q}_{k}+g_{i}(\bm{q}) = \tau_{i},
		\end{equation}
		%%%
		for $i=1,\dots,n$. As it is clear from \cref{eq:lageqbla} there 
		is a quadratic term in the generalized velocities $\dot{q}_{j}\dot{q}_{k}$,
		therefore it is convenient to introduce the symbol $h_{ijk}(\bm{q})\in\mathbb{R}$,
		with $i,j,k = 1,\dots,n$, defined as
		%%%
		\begin{equation}
			\label{eq:lagsymbols}
			h_{ijk}(\bm{q}) := \frac{\partial m_{ij}(\bm{q})}{\partial q_{k}}
			-\frac{1}{2}\frac{\partial m_{jk}(\bm{q})}{\partial q_{i}}. 
		\end{equation}
		%%%
		Thus substituting \cref{eq:lagsymbols} into \cref{eq:lageqbla}
		the equations of motion result in the more compact representations
		%%%
		\begin{equation}
			\label{eq:equationofmotioncomponent}
			\sum_{j=1}^{n}m_{ij}(\bm{q})\ddot{q}_{i} +
			\sum_{j=1}^{n}\sum_{k=1}^{n}h_{ijk}(\bm{q})\dot{q}_{j}\dot{q}_{k} + g_{i}(\bm{q}) = \tau_{i},
		\end{equation}
		%%%
		for $i=1,\dots,n$. Now let us analyse \cref{eq:equationofmotioncomponent} 
		to provide a physical interpretation of the different terms:
		%%%
		\begin{itemize}
			\item The coefficients $m_{ii}(\bm{q})$, with $i =1,\dots,n$,
			represent the generalized masses associated to the $i$-th degree of freedom.
			\item The coefficients  $m_{ij}(\bm{q})$, with $i,j =1,\dots,n$ but $i\neq j$, 
			represent the \emph{inertia forces} induced by the $j$-th degree of freedom over the $i$-th. 
			\item The quadratic terms $h_{ijj}\dot{q}_{j}^{2}$, with $j = 1,\dots,n$,
			represent \emph{centrifugal effect} induced on the $i$-th degree of 
			freedom by the $j$-th. Notice that the $i$-th degree of freedom
			does not induce any centrifugal effect on itself, i.e., $h_{iii}$ = 0.
			\item The terms $h_{ijj}\dot{q}_{j}\dot{q}_{k}$, with $j,k=1,\dots,n$
			but $i\neq j$ represents the \emph{Coriolis} effects induced on the
			degree of freedom $i$-th by velocities of degrees of freedom $j$-th and $k$-th.
			\item The terms $g_{i}(\bm{q})$, with $i=1,\dots,n$, represent
			the \emph{conservative generalized forces} acting on the $i$-th degree of freedom.
		\end{itemize}
		%%%
		At this point it is very useful to rewrite the equations of 
		motion (\ref{eq:equationofmotioncomponent}) in a compact matrix notation as follows:
		%%%
		\begin{equation}
			\bm{M}(\bm{q})\ddot{\bm{q}} + \bm{C}(\bm{q},\dot{\bm{q}})\dot{\bm{q}} + \bm{g}(\bm{q}) = \bm{\tau},
		\end{equation}
		%%%
		where $\bm{C}(\bm{q},\dot{\bm{q}})$ is a suitable matrix that 
		takes into account the centrifugal and the Coriolis effects.
		The choice of this matrix is not unique, since it is sufficient 
		that the elements $c_{ij}$ satisfies the relation
		%%%
		\begin{equation}
			\sum_{j=1}^{n}c_{ij}(\bm{q})\dot{q}_{j}
			= \sum_{j=1}^{n}\sum_{k=1}^{n}h_{ijk}(\bm{q})\dot{q}_{j}\dot{q}_{k}.
		\end{equation}
		%%%
		Nevertheless a very common choice is to set the elements 
		$c_{ij}(\bm{q})\in\bm{C}(\bm{q},\dot{\bm{q}})$ as
		%%%
		\begin{equation}
			\label{eq:coriolismatrixdefinition}
			c_{ij}(\bm{q}) = \sum_{k=1}^{n}c_{ijk}(\bm{q})\dot{q}_{k},
		\end{equation}
		%%%
		with $i,j=1,\dots,n$. Here the symbol $c_{ijk}(\bm{q})\in\mathbb{R}$ is
		called \emph{Christoffel symbols of the first type} and it is defined as
		%%%
		\begin{equation}
			c_{ijk}(\bm{q}) = \frac{1}{2}
			\left(\frac{\partial m_{ij}(\bm{q})}{\partial q_{k}}+
			\frac{\partial m_{ik}(\bm{q})}{\partial q_{j}}
			-\frac{\partial m_{jk}(\bm{q})}{\partial q_{i}}\right).
		\end{equation}
		%%%
		Notice that thanks to the symmetry of $\bm{M}(\bm{q})$ 
		the following remarkable property of indici exchange holds,
		%%%
		\begin{equation}
			c_{ijk}(\bm{q}) = c_{ikj}(\bm{q}).
		\end{equation}
		%%%
		Moreover, if the Coriolis-centrifugal matrix $C(\bm{q},\dot{\bm{q}})$ 
		is chosen according to \cref{eq:coriolismatrixdefinition}, then the following matrix
		%%%
		\begin{equation}
			\dot{\bm{M}}(\bm{q})-2\bm{C}(\bm{q},\dot{\bm{q}}),
		\end{equation}
		%%%
		is skew symmetric.
		This property is sometimes useful to synthesize
		control algorithms for mechanical systems.
		
	\section{Euler-Lagrange equations with redundant coordinates}
		What we developed until now holds for systems with a \emph{minimum set of coordinates}.
		Nevertheless for many real systems is quite hard to write directly kinetic and potential
		energy using a small set of coordinates.
		A more common approach is to introduce more generalized coordinates than necessary
		and then add constraints.
		This fact provides the motivation to investigate the equations of motions
		for mechanical systems using a non-minimum set of generalized coordinates.
		For this purpose let us consider that vector $\bm{q}\in\mathbb{R}^{n}$ \emph{does not}
		represent a minimum set of coordinates.
		Therefore in order to correctly represent the system we need to impose
		some constraints. A set of constrain equations can be formally thought as
		a vectorial function of the form
		$\bm{\phi}:\mathbb{R}^{n}\times\mathbb{R}\rightarrow\mathbb{R}^{m}$
		where $m$ is the number of constrains.
		The type of constraints equations that we consider are \emph{holomic},
		meaning that they depend only on generalized coordinates $\bm{q}$ and
		possibly time $t$. Holomic constrains can be expressed in the following general form,
		%%%
		\begin{equation}\label{eq:constraintsequations}
			\bm{\phi}(\bm{q},t) = 0.
		\end{equation}
		%%%
		\begin{remark}
			The total number of degrees of freedom for the system is not $n-m$,
			unless some regularity for $\bm{\phi}(\bm{q},t)$ is assumed.
			Technically if $\forall\bm{q}\in\mathbb{R}^{n}$, $\forall t\in\mathbb{R}$
			the $\rank{\frac{\partial\bm{\phi}(\bm{q},t)}{\partial \bm{q}}} = m$,
			then constraints are globally linearly independent each other and the
			system owns exactly $n-m$ degrees of freedom.
			Trivially we implicitly assumed that $\bm{\phi}$ is differentiable.
		\end{remark}
		%%%
		Now our aim is to derive the equations of motions for a constrained
		mechanical systems described by a Lagrangian function $L(\bm{q},\dot{\bm{q}},t)$
		and subject to constrain equation $\bm{\phi}(\bm{q},t)=0$.
		In order to do so, we can use the technique of Lagrange multipliers
		on functional spaces. So let us define the \emph{modified action} $\bar{S}\in\mathbb{R}$ as 
		%%%
		\begin{equation}
			\label{eq:modifiedaction}
			\bar{S} := \int_{t_{1}}^{t_{2}}
			L(\bm{q},\dot{\bm{q}},t)+\bm{\lambda}^{\intercal}\bm{\phi}(\bm{q},t)\diff t. 
		\end{equation}
		%%%
		Here $\bm{\lambda}\in\mathbb{R}^{m}$ is a time dependent vector of \emph{Lagrange multipliers}.
		The following result is fundamental for our purpose.
		%%%
		\begin{theorem}[Stationary action for constrained systems]
			Motion of mechanical systems from configuration $\bm{q}_{1}$
			to configuration $\bm{q}_{2}$, with $t\in[t_{1}; t_{2}]$,
			coincide with extremals curves of the functional (\ref{eq:modifiedaction}).
			Or equivalently, for small variations of the curve $\bm{q}(\cdot)$
			the modified action $\bar{S}$ is stationary, i.e.,
			%%%
			\begin{equation*}
				\delta\bar{S} = 0.
			\end{equation*}
			%%%
		\end{theorem}
		%%%
		\begin{remark}
			Notice that we implicitly assumed that initial and
			final configuration $\bm{q}_{1}$, $\bm{q}_{2}$ are
			consistent with constrain equations, i.e., $\bm{\phi}(\bm{q}_{1},t_{1})
			= \bm{\phi}(\bm{q}_{2},t_{2})= 0$.
		\end{remark}
		%%%
		Thus we can think to perform variation as done before for
		systems with a minimal set of coordinates, 
		but there is a difference, since now $\bar{S}$ also depends
		on the Lagrange multipliers.
		Therefore the variational operator $\delta$ performs
		variations on $\bm{q}$, $\bm{\dot{q}}$ and $\bm{\lambda}$.
		The result is the following,
		%%%
		\begin{subequations}
			\begin{align}
				\label{eq:variationmodifiedaction}
				\delta\bar{S} &= \int_{t_{1}}^{t_{2}}
				\delta L(\bm{q},\dot{\bm{q}},t)+
				\delta\bm{\lambda}^{\intercal}\bm{\phi}(\bm{q},t)+
				\bm{\lambda}^{\intercal}\delta\bm{\phi}(\bm{q},t)\diff t\\
				&=  \int_{t_{1}}^{t_{2}}\left(\frac{\partial L}{\partial\bm{q}}
				- \frac{\diff}{\diff t}\frac{\partial L}{\partial\dot{\bm{q}}}
				+\bm{\lambda}^{\intercal}\frac{\partial\bm{\phi}}{\partial\bm{q}}\right)\delta\bm{q}
				+\delta\bm{\lambda}^{\intercal}\bm{\phi}(\bm{q},t)\diff t
				+\left[\frac{\partial L}{\partial\dot{\bm{q}}}\delta\bm{q} \right]_{t_{1}}^{t_{2}}\\
				&=\int_{t_{1}}^{t_{2}}
				\begin{bmatrix}
					\frac{\partial L}{\partial\bm{q}}
					- \frac{\diff}{\diff t}\frac{\partial L}{\partial\dot{\bm{q}}}
					+ \bm{\lambda}^{\intercal}\frac{\partial\bm{\phi}}{\partial\bm{q}}
					& \bm{\phi}^{\intercal}
				\end{bmatrix}
				\begin{bmatrix}
					\delta\bm{q} \\
					\delta\bm{\lambda}
				\end{bmatrix} \diff t = 0,
			\end{align}
		\end{subequations} 
		%%%
		again we used that endpoints variations
		$\delta\bm{q}_{1} = \delta\bm{q}_{2} = 0$.
		Finally applying the fundamental lemma of calculus of
		variations \cref{eq:variationmodifiedaction}, results
		%%%
		\begin{subequations}
			\label{eq:mechanicalDAE}
			\begin{align}
				\frac{\diff}{\diff t}\frac{\partial L}{\partial\dot{\bm{q}}}^{\intercal}
				-\frac{\partial L}{\partial \bm{q}}^{\intercal}
				&= \frac{\partial\bm{\phi}}{\partial\bm{q}}^{\intercal}\bm{\lambda}, \\
				\bm{\phi}(\bm{q},t) &= 0.
			\end{align}
		\end{subequations}
		%%%
		The equations (\ref{eq:mechanicalDAE}) describe the motion of a mechanical
		system subject to holomic constraints.
		Note that the term $\frac{\partial\bm{\phi}}{\partial\bm{q}}^{\intercal}\bm{\lambda}$
		plays the role of a constrain generalized force which pushes the system to
		satisfy the constraints $\bm{\phi}(\bm{q},t) = 0$.
		Unfortunately problem in \cref{eq:mechanicalDAE} is completely different
		from the one in \cref{eq:euleroequations}, since it is a mixture of
		\emph{differential} and \emph{algebraic} equations, formally a
		\emph{Differential Algebraic Equation} (DAE).
		Moreover, apparently \cref{eq:mechanicalDAE}, does not provide any
		way to determine the value of the Lagrange multipliers.
		Similarly in presence of external non-conservative generalized
		forces the equation of motions for a constrained mechanical
		system are modified as follows,
		%%%
		\begin{subequations}
			\begin{align}
				\frac{\diff}{\diff t}\frac{\partial L}{\partial\dot{\bm{q}}}^{\intercal}
				-\frac{\partial L}{\partial \bm{q}}^{\intercal}
				&= \frac{\partial\bm{\phi}}{\partial\bm{q}}^{\intercal}\bm{\lambda}+\bm{\tau},\\
				\bm{\phi}(\bm{q},t) &= 0,
			\end{align}
		\end{subequations}
		%%%
		again with $\tau\in\mathbb{R}^{n}$ a vector of generalized non-conservative forces.
		%%%
		\begin{example}
			\label{ex:pendulum1}
			Let us consider a simple mechanical example,
			the pendulum, see \cref{fig:pendulum}.
			%%%
			\input{pictures/pendulum.tex}
			%%%
			Pendulum own one-degree of freedom and taking the angular
			coordinate $\theta\in[0,2\pi)$ as generalized coordinate,
			the following relationships with $(x,y)\in\mathbb{R}^{2}$ hold, 
			%%%
			\begin{equation*}
			  x = \ell\sin{\theta}, \quad y = -\ell\cos{\theta}.
			\end{equation*}
			%%%
			Thus kinetic and potential energy can be expressed as, 
			%%%
			\begin{equation*}
				T(\theta) = \frac{1}{2}m(\dot{x}^{2}+\dot{y}^{2})
				= \frac{1}{2}m\ell^{2}\dot{\theta}^{2},\quad U(\theta)
				= gmy = -gm\ell\cos{\theta}, 
			\end{equation*}
			%%%
			while the Lagrangian for the system results, 
			%%%
			\begin{equation*}
				L = \frac{1}{2}m\ell^{2}\dot{\theta}^{2} + gm\ell\cos{\theta}.
			\end{equation*}
			%%%
			Using the Euler-Lagrange equations in \cref{eq:euleroequations} yields to
			%%%
			\begin{equation*}
				\frac{\diff}{\diff t}\frac{\partial L}{\partial\dot{\theta}}
				-\frac{\partial L}{\partial\theta} = m\ell^{2}\ddot{\theta} + mg\ell\sin{\theta} = 0,
			\end{equation*}
			%%%
			which can be simplified to
			%%%
			\begin{equation*}
				\ddot{\theta} = -\frac{g}{\ell}\sin{\theta}.
			\end{equation*}
			%%%
			Now suppose we want to describe the pendulum using
			a set of redundant coordinates, e.g., \emph{natural coordinates}.
			For this aim let us define the generalized coordinate $\bm{q} = (x;y)\in\mathbb{R}^{2}$.
			The associated Lagrangian function takes the form, 
			%%%
			\begin{equation*}
				L = \frac{1}{2}m\transp{\dot{\bm{q}}}\bm{\dot{q}} - mg\transp{\bm{e}}_{2}\bm{q},
			\end{equation*}
			%%%
			where $\bm{e}_{2}\in\mathbb{R}^{2}$ is the second vector of 
			the natural basis, roughly speaking the vector
			$\bm{e}_{2} = (0;1)\in\mathbb{R}^{2}$.
			Obviously now we need to introduce some constraint equation
			in order to force mass $m$ to slide over the circle, i.e., 
			%%%
			\begin{equation*}
				\phi(\bm{q}) = x^{2}+y^{2} - \ell^{2} = \transp{\bm{q}}\bm{q}-\ell^{2} = 0.
			\end{equation*}
			%%%
			Using then \cref{eq:mechanicalDAE} the resultant system of equations is the following,
			%% 
			\begin{subequations}
				\begin{align*}
					m\ddot{\bm{q}} + mg\bm{e}_{2} &= 2\bm{q}\lambda, \\
					\transp{\bm{q}}\bm{q}-\ell^{2} &= 0.
				\end{align*}
			\end{subequations}
		\end{example}
		